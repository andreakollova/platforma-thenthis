{# templates/projekt-html.html â€” Blackjack (kroky vÄ¾avo, zvÃ½raznenie prÃ­rastkov, hero s ikonou) #}
{% extends "base.html" %}
{% block title %}Projekt HTML â€“ Blackjack{% endblock %}

{% block content %}
<style>
  /* --- Scoped Å¡tÃ½ly pre projekt ------------------------------------------ */
  .proj * { box-sizing: border-box; }
  .proj .pill { border:1px solid #e5e7eb; background:#fff; border-radius:999px; padding:.3rem .6rem; font-size:.8rem; color:#6b7280; }
  .proj .progress-thin { height:8px; background:#f3f4f6; border-radius:999px; overflow:hidden; border:1px solid #e5e7eb; }
  .proj .progress-thin > i { display:block; height:100%; width:0%; background:linear-gradient(90deg,#3b82f6,#22c55e); }

  .proj .steps { list-style:none; padding-left:0; margin:0; }
  .proj .steps li {
    display:flex; align-items:center; gap:.5rem; padding:.55rem .6rem; border-radius:.75rem; cursor:pointer;
    border:1px solid transparent;
  }
  .proj .steps li:hover { background:#f8fafc; }
  .proj .steps li.active { background:#eff6ff; border:1px solid #bfdbfe; }
  .proj .steps li.done   { background:#ecfdf5; border:1px solid #86efac; }
  .proj .steps .idx {
    width:28px; height:28px; display:grid; place-items:center; border-radius:.6rem; border:1px solid #e5e7eb; background:#fff;
    font-weight:700; font-size:.8rem; color:#111827;
  }
  .proj .steps .state { margin-left:auto; font-size:.8rem; color:#16a34a; font-weight:700; }

  .proj details { border:1px dashed #e5e7eb; background:#fafafa; border-radius:.75rem; padding:.6rem .75rem; }
  .proj summary { cursor:pointer; font-weight:700; }

  .proj .card { border-radius:1rem; }
  .proj .card-header { background:#fff; }

  /* hero card â€“ o trochu menÅ¡Ã­ vertikÃ¡lny padding */
  .proj .hero-left { padding-top:.75rem !important; padding-bottom:.75rem !important; }

  /* kÃ³d + zvÃ½raznenie prÃ­rastkov v danom kroku */
  .proj .code-shell { position:relative; }
  .proj .copy-btn {
    position:absolute; top:.5rem; right:.5rem;
    border:1px solid #e5e7eb; background:#fff; border-radius:.5rem; padding:.25rem .5rem; font-size:.8rem;
  }
  .proj pre.code-block { margin:0; padding:1rem .75rem .75rem 1rem; background:#0f172a; color:#dbeafe; border-radius:.75rem; font-size:.9rem; overflow:auto; }
  .proj pre.code-block code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; white-space: pre; display:block; }
  .proj .code-line { display:block; padding-left:.5rem; border-left:3px solid transparent; }
  .proj .code-line.added { background:#ecfdf5; border-left-color:#22c55e; color:#052e16; } /* zelenÃ© novinky */
  .proj .muted { color:#6b7280; }

  /* jazykovÃ© badge */
  .lang-badges .badge { background:#fff; border:1px solid #e5e7eb; color:#374151; }
  .lang-badges .badge i { margin-right:.35rem; }
</style>

<section class="proj">
  <!-- HERO / HLAVIÄŒKA S FOTKOU ---------------------------------------------->
  <div class="card shadow-sm mb-3">
    <div class="row g-0 align-items-center">
      <div class="col-12 col-lg-8 hero-left p-2 ps-3 pe-3">
        <div class="d-flex align-items-start gap-3">
          <!-- ikonka (ponechanÃ¡) -->
          <div style="width:44px;height:44px;border-radius:12px;border:1px solid #e5e7eb;background:
              radial-gradient(circle at 30% 25%, #93c5fd, transparent 45%),
              radial-gradient(circle at 75% 70%, #86efac, transparent 45%),
              #fff;" aria-hidden="true"></div>
          <div class="flex-grow-1">
            <h1 class="h4 mb-1">Projekt: <strong>Blackjack</strong></h1>
            <div class="d-flex flex-wrap gap-2 mb-2">
              <span class="pill">ÃšroveÅˆ: ZaÄiatoÄnÃ­k â†’ PokroÄilÃ½</span>
              <span class="pill">PrimÃ¡rne: Python (CLI)</span>
              <span class="pill">ÄŒas: ~45â€“90 min</span>
            </div>
            <div class="lang-badges d-flex flex-wrap gap-2 mb-1">
              <span class="badge rounded-pill px-2 py-1"><i class="fab fa-python"></i>Python</span>
              <span class="badge rounded-pill px-2 py-1"><i class="fab fa-js"></i>JavaScript</span>
              <span class="badge rounded-pill px-2 py-1"><i class="fab fa-html5"></i>HTML</span>
              <span class="badge rounded-pill px-2 py-1"><i class="fab fa-css3-alt"></i>CSS</span>
            </div>
            <div class="small text-muted">
              <strong>NÃ¡hÄ¾ad:</strong>
              <a href="https://blackjack.onrender.com/" target="_blank" rel="noopener">https://blackjack.onrender.com/</a>
            </div>
          </div>
        </div>
      </div>
      <!-- Fotka pri nÃ¡zve projektu -->
      <div class="col-12 col-lg-4">
        <img
          src="{{ url_for('static', filename='projects/blackjack2.png') }}"
          class="img-fluid rounded-end"
          alt="Blackjack â€“ nÃ¡hÄ¾ad"
          style="object-fit: cover; width: 100%; height: 100%; max-height: 220px;"
        >
      </div>
    </div>
  </div>

  <div class="row g-3">
    <!-- LEFT: kroky + progres -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header d-flex align-items-center justify-content-between">
          <div class="fw-semibold">Kroky projektu</div>
          <span class="text-muted small" id="doneCount">0 / 6 hotovo</span>
        </div>
        <div class="card-body">
          <div class="progress-thin mb-3" aria-label="Priebeh">
            <i id="progressBar"></i>
          </div>
          <ul id="steps" class="steps" role="tablist" aria-label="Kroky"></ul>
        </div>
      </div>
    </div>

    <!-- RIGHT: Zadanie / Krok / Introspekcia -->
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header d-flex align-items-center justify-content-between">
          <div class="fw-semibold" id="panelTitle">Zadanie</div>
          <div class="d-flex flex-wrap gap-2">
            <button class="btn btn-soft btn-sm" id="showAssignment">ZobraziÅ¥ zadanie</button>
            <button class="btn btn-soft btn-sm" id="showIntrospect">Introspekcia</button>
          </div>
        </div>
        <div class="card-body">
          <!-- Zadanie -->
          <div id="assignment">
            <p class="text-muted">
              Postupne vytvorÃ­Å¡ <strong>konzolovÃº hru Blackjack v Pythone</strong>. KaÅ¾dÃ½ krok obsahuje
              <em>vysvetlenie</em>, <em>checklist</em>, <em>hinty</em> a <em>celÃ½ kÃ³d</em> pre danÃ½ stav projektu.
              VÅ¾dy zvÃ½raznÃ­me <span style="background:#ecfdf5;border-left:3px solid #22c55e;padding:0 .25rem;color:#052e16;">novÃ© riadky</span>,
              aby si presne vedel, Äo pribudlo.
            </p>

            <details class="mb-3" open>
              <summary><strong>Tipy pred zaÄatÃ­m projektu</strong></summary>
              <ul class="mt-2 mb-0">
                <li>Rob <strong>po malÃ½ch Äastiach</strong> a po kaÅ¾dej zmene program <strong>spusÅ¥</strong>.</li>
                <li><strong>Eso (A)=11</strong>, ale ak by si mal &gt;21, zmenÃ­me jedno eso na <strong>1</strong>.</li>
                <li><strong>Blackjack</strong> = 21 z <em>dvoch</em> kariet â†’ v kÃ³de ho oznaÄÃ­me <code>0</code> pre Ä¾ahkÃ© porovnanie.</li>
                <li>Ak si neistÃ½, skopÃ­ruj â€CelÃ½ kÃ³dâ€œ â€“ je to presnÃ¡ podoba sÃºboru v danom kroku.</li>
              </ul>
            </details>

            <button id="startProject" class="btn btn-primary">
              ZaÄaÅ¥ projekt
            </button>
          </div>

          <!-- Krok (detail) -->
          <div id="stepView" hidden>
            <div id="stepContent"></div>
            <div class="d-flex justify-content-end gap-2 mt-3">
              <button class="btn btn-outline-secondary" id="prevStep">&larr; PredchÃ¡dzajÃºci</button>
              <button class="btn btn-success" id="markDone">OznaÄiÅ¥ ako hotovÃ©</button>
              <button class="btn btn-outline-secondary" id="nextStep">ÄalÅ¡Ã­ krok &rarr;</button>
            </div>
          </div>

          <!-- Introspekcia -->
          <div id="introspect" hidden>
            <p class="muted">Tvoje poznÃ¡mky sa ukladajÃº iba lokÃ¡lne (v prehliadaÄi).</p>
            <div class="mb-2">
              <label class="form-label">1) ÄŒo ti uÅ¾ funguje / Äo vidÃ­Å¡ v konzole?</label>
              <textarea id="qOutput" rows="3" class="form-control" placeholder="Napr. Po rozdÃ¡nÃ­ vidÃ­m skÃ³re a viem Å¥ahaÅ¥ karty..."></textarea>
            </div>
            <div class="mb-2">
              <label class="form-label">2) ÄŒo je mÃ¤tÃºce?</label>
              <input id="qConfuse" type="text" class="form-control" placeholder="Napr. kedy sa A zmenÃ­ z 11 na 1">
            </div>
            <div class="mb-3">
              <label class="form-label">3) ÄŒo spravÃ­Å¡ Äalej?</label>
              <input id="qNext" type="text" class="form-control" placeholder="Napr. doplnÃ­m cyklus 'Play again'">
            </div>
            <div class="text-end">
              <button id="saveReflect" class="btn btn-primary">UloÅ¾iÅ¥ reflexiu</button>
            </div>
          </div>
        </div>
      </div> <!-- /card -->
    </div>
  </div>
</section>

<script>
  /* -------------------- PomocnÃ© pre renderovanie kÃ³du --------------------- */
  function escapeHtml(s){
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
  function codeHtml(lines, addedIdxSet){
    return lines.map((ln, i)=>{
      const cls = addedIdxSet.has(i) ? 'code-line added' : 'code-line';
      return `<span class="${cls}">${escapeHtml(ln)}</span>`;
    }).join('\n');
  }
  function addedIdxs(currLines, prevLines){
    const prevSet = new Set(prevLines || []);
    const set = new Set();
    currLines.forEach((ln, idx)=>{ if(!prevSet.has(ln)) set.add(idx); });
    return set;
  }

  /* -------------------- KROKOVÃ‰ KÃ“DY (po riadkoch) ------------------------ */
  const step1_lines = [
    "import random",
    "",
    "print(r\"\"\"          _____",
    "         |A .  | _____",
    "         | /.\\ ||A ^  | _____",
    "         |(_._)|| / \\ ||A _  | _____",
    "         |  |  || \\ / || ( ) ||A_ _ |",
    "         |____V||  .  ||(_'_)||( v )|",
    "                |____V||  |  || \\ / |",
    "                       |____V||  .  |",
    "                              |____V|",
    "\"\"\")",
    "",
    "def deal_cards():",
    "    cards = [11, 2, 3, 4, 5, 6, 7, 8, 9, 10, 10, 10, 10]",
    "    return random.choice(cards)",
    "",
    "def calculate_score(cards):",
    "    # Blackjack (21 z dvoch kariet)",
    "    if sum(cards) == 21 and len(cards) == 2:",
    "        return 0",
    "    # Eso 11 -> 1 ak by sÃºÄet presiahol 21",
    "    while 11 in cards and sum(cards) > 21:",
    "        cards[cards.index(11)] = 1",
    "    return sum(cards)",
    "",
    "def compare(user_score, computer_score):",
    "    if user_score == computer_score:",
    "        return \"RemÃ­za.\"",
    "    elif computer_score == 0:",
    "        return \"Prehral si, dealer mÃ¡ Blackjack!\"",
    "    elif user_score == 0:",
    "        return \"Vyhral si Blackjackom! ğŸ‰\"",
    "    elif user_score > 21:",
    "        return \"Prehral si, presiahol si 21.\"",
    "    elif computer_score > 21:",
    "        return \"Vyhral si, dealer presiahol 21!\"",
    "    elif user_score > computer_score:",
    "        return \"Vyhral si! ğŸ‰\"",
    "    else:",
    "        return \"Prehral si.\"",
    ""
  ];

  const step2_lines = [
    ...step1_lines,
    "def play_one_round():",
    "    user_cards = []",
    "    computer_cards = []",
    "    is_game_over = False",
    "",
    "    for _ in range(2):",
    "        user_cards.append(deal_cards())",
    "        computer_cards.append(deal_cards())",
    "",
    "    while not is_game_over:",
    "        user_score = calculate_score(user_cards)",
    "        computer_score = calculate_score(computer_cards)",
    "        print(f\"Your cards {user_cards} and score: {user_score}\")",
    "        print(f\"Computer cards {computer_cards} and score: {computer_score}\")",
    "",
    "        if user_score == 0 or computer_score == 0 or user_score > 21:",
    "            is_game_over = True",
    "        else:",
    "            user_should_deal = input(\"Type 'y' to get another card, type 'n' to pass: \").strip().lower()",
    "            if user_should_deal == 'y':",
    "                user_cards.append(deal_cards())",
    "            else:",
    "                is_game_over = True",
    ""
  ];

  const step3_lines = [
    ...step2_lines.slice(0, -1),
    "    # Dealer Å¥ahÃ¡ do 17",
    "    computer_score = calculate_score(computer_cards)",
    "    while computer_score != 0 and computer_score < 17:",
    "        computer_cards.append(deal_cards())",
    "        computer_score = calculate_score(computer_cards)",
    "",
    "    print(f\"Your final hand: {user_cards}, final score: {user_score}\")",
    "    print(f\"Computer's final hand: {computer_cards}, final score: {computer_score}\")",
    "    print(compare(user_score, computer_score))",
    ""
  ];

  const step4_lines = [
    ...step3_lines,
    "if __name__ == \"__main__\":",
    "    play_one_round()",
    ""
  ];

  const step5_lines = [
    ...step3_lines,
    "if __name__ == \"__main__\":",
    "    while True:",
    "        play_one_round()",
    "        again = input(\"Play again? (y/n): \").strip().lower()",
    "        if again != 'y':",
    "            break",
    ""
  ];

  const step6_lines = [
    ...step1_lines,
    "def ask_yes_no(prompt):",
    "    while True:",
    "        ans = input(prompt).strip().lower()",
    "        if ans in ('y','n'):",
    "            return ans",
    "        print(\"Please type 'y' or 'n'.\")",
    "",
    "def play_one_round():",
    "    user_cards = []",
    "    computer_cards = []",
    "    is_game_over = False",
    "",
    "    for _ in range(2):",
    "        user_cards.append(deal_cards())",
    "        computer_cards.append(deal_cards())",
    "",
    "    while not is_game_over:",
    "        user_score = calculate_score(user_cards)",
    "        computer_score = calculate_score(computer_cards)",
    "        print(f\"Your cards {user_cards} and score: {user_score}\")",
    "        print(f\"Computer cards {computer_cards} and score: {computer_score}\")",
    "",
    "        if user_score == 0 or computer_score == 0 or user_score > 21:",
    "            is_game_over = True",
    "        else:",
    "            user_should_deal = ask_yes_no(\"Type 'y' to get another card, 'n' to pass: \")",
    "            if user_should_deal == 'y':",
    "                user_cards.append(deal_cards())",
    "            else:",
    "                is_game_over = True",
    "",
    "    # Dealer Å¥ahÃ¡ do 17",
    "    computer_score = calculate_score(computer_cards)",
    "    while computer_score != 0 and computer_score < 17:",
    "        computer_cards.append(deal_cards())",
    "        computer_score = calculate_score(computer_cards)",
    "",
    "    print(f\"Your final hand: {user_cards}, final score: {user_score}\")",
    "    print(f\"Computer's final hand: {computer_cards}, final score: {computer_score}\")",
    "    print(compare(user_score, computer_score))",
    "",
    "if __name__ == \"__main__\":",
    "    while True:",
    "        play_one_round()",
    "        again = ask_yes_no(\"Play again? (y/n): \")",
    "        if again != 'y':",
    "            break",
    ""
  ];

  /* -------------------- DEFINÃCIA KROKOV (s detailnÃ½m nÃ¡vodom) ------------ */
  const STEPS = [
    {
      title: "ZÃ¡klad: importy + tri funkcie (deal, score, compare)",
      explain: `
        <p><strong>ÄŒo ideÅ¡ spraviÅ¥:</strong> pripraviÅ¥ stavebnÃ© bloky: nÃ¡hodnÃ© karty, vÃ½poÄet skÃ³re a slovnÃ½ vÃ½sledok.</p>
        <ol>
          <li><strong>Import</strong> <code>random</code> â€“ potrebujeme na nÃ¡hodu.</li>
          <li><strong>ASCII hlaviÄka</strong> â€“ dekorÃ¡cia, nech hra pÃ´sobÃ­ zÃ¡bavne.</li>
          <li><strong><code>deal_cards()</code></strong> â€“ vrÃ¡ti jednu nÃ¡hodnÃº kartu z balÃ­ka (11=A, 10=10/J/Q/K).</li>
          <li><strong><code>calculate_score()</code></strong> â€“ ak sÃº <em>2 karty a 21</em>, vrÃ¡Å¥ <code>0</code> (Blackjack). KeÄ je sÃºÄet &gt; 21 a mÃ¡Å¡ Eso (11), zmeÅˆ <em>jedno</em> Eso na 1 a znova prepoÄÃ­taj, kÃ½m netreba.</li>
          <li><strong><code>compare()</code></strong> â€“ porovnÃ¡ skÃ³re a vrÃ¡ti text: remÃ­za, vÃ½hra/prehra, Å¡peciÃ¡lne prÃ­pady (Blackjack, bust &gt;21).</li>
        </ol>
        <p><em>SkÃºs spustiÅ¥ sÃºbor â€“ zatiaÄ¾ len definuje funkcie (bez hry) a vypÃ­Å¡e hlaviÄku.</em></p>
      `,
      checklist: [
        "Import random + ASCII hlaviÄka.",
        "deal_cards(): nÃ¡hodnÃ¡ karta z [11,2..10].",
        "calculate_score(): Eso 11â†’1, Blackjack=0.",
        "compare(): textovÃ½ vÃ½sledok podÄ¾a skÃ³re."
      ],
      hint: `Blackjack (21 z dvoch kariet) oznaÄÃ­me ÄÃ­slom 0 â€“ uÄ¾ahÄÃ­ to porovnÃ¡vanie.`,
      codeLines: step1_lines
    },
    {
      title: "HrÃ¡Äov Å¥ah (play_one_round â€“ ÄasÅ¥ 1)",
      explain: `
        <p><strong>ÄŒo ideÅ¡ spraviÅ¥:</strong> vytvorÃ­Å¡ funkciu, ktorÃ¡ rozdanÃ­ karty a spracuje rozhodnutie hrÃ¡Äa (Hit/Stand).</p>
        <ol>
          <li>Pridaj <code>play_one_round()</code> a v Åˆom tri premennÃ©: <code>user_cards</code>, <code>computer_cards</code>, <code>is_game_over</code>.</li>
          <li>Rozdaj <strong>2 karty</strong> hrÃ¡Äovi aj dealerovi (for-cyklus 2Ã—).</li>
          <li>V sluÄke <code>while not is_game_over</code> vÅ¾dy prepoÄÃ­taj skÃ³re oboch a vypÃ­Å¡ ich.</li>
          <li>Ak hrÃ¡Ä/dealer mÃ¡ Blackjack <em>alebo</em> hrÃ¡Ä presiahne 21 â†’ ukonÄi Å¥ah (<code>is_game_over=True</code>).</li>
          <li>Inak sa spÃ½taj: <code>'y'</code> (Hit) â†’ pridaj kartu hrÃ¡Äovi; <code>'n'</code> (Stand) â†’ ukonÄi hrÃ¡Äov Å¥ah.</li>
          <li>Vstup vÅ¾dy ÄistÃ­me: <code>.strip().lower()</code>.</li>
        </ol>
        <p><em>Po tomto kroku vieÅ¡ Å¥ahaÅ¥ karty pre hrÃ¡Äa. Dealer zatiaÄ¾ nehrÃ¡.</em></p>
      `,
      checklist: [
        "Vytvor play_one_round().",
        "Rozdaj dve karty hrÃ¡Äovi aj dealerovi.",
        "SluÄka: prepoÄÃ­taj skÃ³re, pÃ½taj sa na 'y'/'n'."
      ],
      hint: `Ak 'y' â†’ pridaj kartu, ak nie â†’ nastav is_game_over=True.`,
      codeLines: step2_lines
    },
    {
      title: "Dealerov Å¥ah + vÃ½sledok (play_one_round â€“ ÄasÅ¥ 2)",
      explain: `
        <p><strong>ÄŒo ideÅ¡ spraviÅ¥:</strong> po hrÃ¡Äovi hrÃ¡ dealer â€“ Å¥ahÃ¡, kÃ½m mÃ¡ skÃ³re <strong>&lt; 17</strong> a nemÃ¡ Blackjack.</p>
        <ol>
          <li>Po hrÃ¡Äovi <strong>prepoÄÃ­taj</strong> dealerovo skÃ³re.</li>
          <li><code>while computer_score != 0 and computer_score &lt; 17</code> â†’ dealer doÅ¥ahuje a vÅ¾dy hneÄ prepoÄÃ­taj skÃ³re.</li>
          <li>Nakoniec <strong>vypÃ­Å¡ finÃ¡lne</strong> ruky a skÃ³re, zavolaj <code>compare()</code> a vypÃ­Å¡ vÃ½sledok.</li>
        </ol>
        <p><em>Po tomto kroku sa uÅ¾ dÃ¡ dohraÅ¥ celÃ¡ partia.</em></p>
      `,
      checklist: [
        "Dealer Å¥ahÃ¡ do 17 (a nie je v Blackjacku).",
        "VypÃ­Å¡ finÃ¡lne karty a skÃ³re.",
        "VypÃ­Å¡ vÃ½sledok z compare()."
      ],
      hint: `Nezabudni prepoÄÃ­taÅ¥ skÃ³re po kaÅ¾dej dealerovej karte.`,
      codeLines: step3_lines
    },
    {
      title: "SpusÅ¥ jednu hru (main blok)",
      explain: `
        <p><strong>ÄŒo ideÅ¡ spraviÅ¥:</strong> pridaÅ¥ <code>if __name__ == "__main__"</code> a spustiÅ¥ <code>play_one_round()</code>.</p>
        <p>Tento blok sa vykonÃ¡, len keÄ sÃºbor spÃºÅ¡Å¥aÅ¡ priamo (nie pri importe).</p>
      `,
      checklist: [
        "Pridaj if __name__ == '__main__':",
        "Zavolaj play_one_round()."
      ],
      hint: `Teraz po spustenÃ­ prebehne presne jedna partia.`,
      codeLines: step4_lines
    },
    {
      title: "Opakovanie hier (Play again)",
      explain: `
        <p><strong>ÄŒo ideÅ¡ spraviÅ¥:</strong> po skonÄenÃ­ partie sa opÃ½taj, Äi chceÅ¡ hraÅ¥ znova.</p>
        <ol>
          <li>ObaÄ¾ spÃºÅ¡Å¥anie do <code>while True</code>.</li>
          <li>Po hre sa spÃ½taj: <code>Play again? (y/n)</code>. Ak odpoveÄ nie je <code>'y'</code>, ukonÄi program cez <code>break</code>.</li>
        </ol>
        <p><em>VieÅ¡ hraÅ¥ viac hier za sebou bez reÅ¡tartu programu.</em></p>
      `,
      checklist: [
        "ZabaÄ¾ spustenie do while True.",
        "OpÃ½taj sa 'Play again?'; ak != 'y', ukonÄi program."
      ],
      hint: `Na vstup pouÅ¾Ã­vaj .strip().lower() â€“ ignoruje medzery a veÄ¾kÃ© pÃ­smenÃ¡.`,
      codeLines: step5_lines
    },
    {
      title: "LepÅ¡Ã­ vstup (validÃ¡cia Ã¡no/nie)",
      explain: `
        <p><strong>ÄŒo ideÅ¡ spraviÅ¥:</strong> vytvor <code>ask_yes_no()</code>, ktorÃ¡ sa pÃ½ta dovtedy, kÃ½m nedostane <code>'y'</code> alebo <code>'n'</code>.</p>
        <ol>
          <li>V cykle ÄÃ­taj vstup, ÄistÃ½ reÅ¥azec porovnaj â€“ ak nie je povolenÃ½, vypÃ­Å¡ inÅ¡trukciu a pÃ½taj sa znova.</li>
          <li>V <code>play_one_round()</code> ju pouÅ¾i na <em>Hit/Stand</em>.</li>
          <li>V <code>__main__</code> ju pouÅ¾i na <em>Play again</em>.</li>
        </ol>
        <p><em>TÃ½mto je program odolnejÅ¡Ã­ a prÃ­vetivejÅ¡Ã­.</em></p>
      `,
      checklist: [
        "Vytvor ask_yes_no(prompt) s validÃ¡ciou.",
        "PouÅ¾i ju pri Å¥ahanÃ­ karty aj pri 'Play again?'."
      ],
      hint: `PouÅ¾Ã­vateÄ¾ obÄas zadÃ¡ aj prÃ¡zdny vstup â€“ preto validujeme v sluÄke.`,
      codeLines: step6_lines
    }
  ];

  /* -------------------- STORAGE stavu (po definÃ­cii STEPS!) ---------------- */
  const store = {
    load(){ try{ const raw=localStorage.getItem('bj_step_state_v1'); return raw?JSON.parse(raw):{step:0,done:Array(STEPS.length).fill(false),notes:{}} }catch{ return {step:0,done:Array(STEPS.length).fill(false),notes:{}} },
    save(s){ localStorage.setItem('bj_step_state_v1', JSON.stringify(s)); }
  };
  let state = store.load();

  /* -------------------- DOM odkazy ----------------------------------------- */
  const stepsUL = document.getElementById('steps');
  const doneCount = document.getElementById('doneCount');
  const progressBar = document.getElementById('progressBar');
  const panelTitle = document.getElementById('panelTitle');

  const assignmentView = document.getElementById('assignment');
  const stepView = document.getElementById('stepView');
  const introspectView = document.getElementById('introspect');

  const showAssignmentBtn = document.getElementById('showAssignment');
  const showIntrospectBtn = document.getElementById('showIntrospect');
  const startProjectBtn = document.getElementById('startProject');

  const stepContent = document.getElementById('stepContent');
  const prevStepBtn = document.getElementById('prevStep');
  const nextStepBtn = document.getElementById('nextStep');
  const markDoneBtn = document.getElementById('markDone');

  const qOutput = document.getElementById('qOutput');
  const qConfuse = document.getElementById('qConfuse');
  const qNext = document.getElementById('qNext');
  const saveReflect = document.getElementById('saveReflect');

  /* -------------------- prepÃ­nanie panelov --------------------------------- */
  function setPanel(which){
    assignmentView.hidden = which!=='A';
    stepView.hidden = which!=='S';
    introspectView.hidden = which!=='I';
    panelTitle.textContent = which==='A' ? 'Zadanie' : which==='S' ? `Krok ${state.step+1}: ${STEPS[state.step].title}` : 'Introspekcia';
  }
  showAssignmentBtn.onclick = ()=> setPanel('A');
  showIntrospectBtn.onclick = ()=> setPanel('I');
  startProjectBtn.onclick = ()=> { setPanel('S'); selectStep(0); };

  /* -------------------- Ä¾avÃ½ zoznam krokov --------------------------------- */
  function renderSteps(){
    stepsUL.innerHTML = '';
    STEPS.forEach((s,i)=>{
      const li = document.createElement('li');
      const classes = ['border']; if(state.step===i) classes.push('active'); if(state.done[i]) classes.push('done');
      li.className = classes.join(' ');
      li.role='tab'; li.ariaSelected = state.step===i;
      li.innerHTML = `<span class="idx">${i+1}</span><span class="fw-semibold">${s.title}</span><span class="state">${state.done[i]?'âœ“ hotovo':''}</span>`;
      li.onclick = ()=>{ state.step=i; store.save(state); selectStep(i); };
      stepsUL.appendChild(li);
    });
    const done = state.done.filter(Boolean).length;
    doneCount.textContent = `${done} / ${STEPS.length} hotovo`;
    progressBar.style.width = `${(done/STEPS.length)*100}%`;
  }

  /* -------------------- detail kroku --------------------------------------- */
  function selectStep(i){
    renderSteps(); setPanel('S');

    const S = STEPS[i];
    const prevLines = i>0 ? STEPS[i-1].codeLines : [];
    const addSet = addedIdxs(S.codeLines, prevLines);

    stepContent.innerHTML = `
      <h3 class="h6 mb-1">${S.title}</h3>
      ${S.explain}
      <h4 class="h6 mt-3">Checklist</h4>
      <div id="checklist" class="d-grid gap-2 mb-2"></div>

      <details class="mb-2">
        <summary>UkÃ¡zaÅ¥ hinty</summary>
        <div class="mt-2">${S.hint}</div>
      </details>

      <details class="mb-0" open>
        <summary>UkÃ¡zaÅ¥ <u>celÃ½ kÃ³d</u> (ako mÃ¡ vyzeraÅ¥ v tomto kroku)</summary>
        <div class="code-shell mt-2">
          <button class="copy-btn" id="copyCode">KopÃ­rovaÅ¥ kÃ³d</button>
          <pre class="code-block"><code>${codeHtml(S.codeLines, addSet)}</code></pre>
        </div>
      </details>
    `;

    // checklist
    const chk = document.getElementById('checklist');
    S.checklist.forEach((label, idx)=>{
      const id=`s${i}c${idx}`; const w=document.createElement('label');
      w.className='d-flex gap-2'; w.innerHTML=`<input type="checkbox" id="${id}" class="form-check-input mt-1"> <span>${label}</span>`;
      chk.appendChild(w);
    });

    // copy
    document.getElementById('copyCode').onclick = ()=>{
      navigator.clipboard.writeText(S.codeLines.join('\n'));
      const btn = document.getElementById('copyCode');
      const old = btn.textContent; btn.textContent='SkopÃ­rovanÃ© âœ“'; setTimeout(()=> btn.textContent=old, 1200);
    };

    // footer
    markDoneBtn.onclick = ()=>{ state.done[i]=true; store.save(state); renderSteps(); };
    prevStepBtn.onclick = ()=>{ if(i>0){ state.step=i-1; store.save(state); selectStep(state.step);} };
    nextStepBtn.onclick = ()=>{ if(i<STEPS.length-1){ state.step=i+1; store.save(state); selectStep(state.step);} };
  }

  /* -------------------- introspekcia --------------------------------------- */
  saveReflect.onclick = ()=>{
    state.notes = { output:qOutput.value, confuse:qConfuse.value, next:qNext.value };
    store.save(state);
    const t=document.createElement('div'); t.className='position-fixed bottom-0 end-0 p-3';
    t.innerHTML='<div class="alert alert-success shadow-sm mb-0">Reflexia uloÅ¾enÃ¡ âœ”</div>';
    document.body.appendChild(t); setTimeout(()=>t.remove(),1600);
  };
  (function loadReflect(){
    qOutput.value = state.notes?.output || '';
    qConfuse.value = state.notes?.confuse || '';
    qNext.value = state.notes?.next || '';
  })();

  /* -------------------- INIT ----------------------------------------------- */
  (function init(){
    // istota: spusti aÅ¾ keÄ je DOM hotovÃ½
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
      return;
    }
    renderSteps();                 // <- kroky viditeÄ¾nÃ© hneÄ
    selectStep(state.step||0);     // <- otvor aktuÃ¡lny krok
    setPanel('A');                 // default: Zadanie
  })();
</script>
{% endblock %}
